---
title: Coming soon - the ability to soft delete datasets and jobs
date: 2022-10-04
author: Maciej Obuchowski & Michael Robinson
image: ./image.svg
banner: ./banner.svg
description: 
---

## Background

An exciting new feature is coming to the Marquez UI: the ability to “soft delete” datasets and jobs. Once work on the feature is finished, users will be able to hide inactive datasets and jobs from the UI, allowing for the easy removal of unused or stale metadata. At this point, most of the necessary backend development is complete. 

## Motivations and Goals

The idea for this feature came out of a need to keep deleted or renamed datasets and jobs from cluttering the lineage view in Marquez. In Issue [#1736](https://github.com/MarquezProject/marquez/issues/1736), project co-creator Julien Le Dem ([@julienledem](https://github.com/julienledem)) suggested a change to the internal Marquez model to create a “new” version of such a dataset or job – a deleted version – that would not show up in the current lineage view produced by GET `/api/v1/lineage`.  

## How It Works

As noted in pull request [#2032](https://github.com/MarquezProject/marquez/pull/2032), the feature works by adding a new flag, `is_hidden`, to the datasets and jobs a user wishes to hide. Then, it changes the `jobs_view` and adds a `datasets_view` that hides any rows where the `is_hidden` flag is set to true.

Conveniently, the soft-delete condition will be reversed whenever the job or dataset is updated because the new version automatically reverts the flag. This will allow Marquez users to preserve dataset and job histories regardless of delete status.
A dataset migration [view](https://github.com/MarquezProject/marquez/blob/main/api/src/main/resources/marquez/db/migration/R__3_Datasets_view.sql) where the flag is used as a condition (`api/src/main/resources/marquez/db/migration/R__3_Datasets_view.sql`):

```
CREATE OR REPLACE VIEW datasets_view
AS
SELECT d.uuid,
       d.type,
       d.created_at,
       d.updated_at,
       d.namespace_uuid,
       d.source_uuid,
       d.name,
       array_agg(CAST((namespaces.name, symlinks.name) AS DATASET_NAME)) AS dataset_symlinks,
       d.physical_name,
       d.description,
       d.current_version_uuid,
       d.last_modified_at,
       d.namespace_name,
       d.source_name,
       d.is_deleted
FROM datasets d
JOIN dataset_symlinks symlinks ON d.uuid = symlinks.dataset_uuid
INNER JOIN namespaces ON symlinks.namespace_uuid = namespaces.uuid
WHERE d.is_hidden IS FALSE
GROUP BY d.uuid;
```

## What’s Next

A new endpoint to make namespaces deletable is in progress (Issue [#2095](https://github.com/MarquezProject/marquez/issues/2095)). The main goal of this addition is to automate the deletion of a large number of datasets and jobs where doing so individually would be a nuisance.

The frontend work is in the design stage. Some questions remain: 
- How should the UI be modified to permit the selection of jobs and datasets for deletion? 
- Should there be a new clickable element in every dataset and job in the graph? 
- Should datasets and jobs be deletable within search results?

Whoever takes on this task will have a shaping role in the discussion and ultimate form of this key addition.

## Getting Started

Contributions to this ongoing effort at implementing a soft delete option Marquez are welcome. If you are interested in contributing, opening an [issue](https://github.com/MarquezProject/marquez/issues) is a good way to get started. 

Check out our [new contributor guide](https://github.com/OpenLineage/OpenLineage/blob/main/CONTRIBUTING.md) to learn more about how to contribute to the project.
