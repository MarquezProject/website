{
    "componentChunkName": "component---src-templates-blog-tsx",
    "path": "/blog/version-30-upgrades/",
    "result": {"data":{"mdx":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Marquez 0.30.0 offers a big performance bump, with some assembly required\",\n  \"date\": \"2023-02-03T00:00:00.000Z\",\n  \"author\": \"Michael Robinson\",\n  \"image\": \"./image.svg\",\n  \"banner\": \"./banner.svg\",\n  \"description\": \"How to ensure a smooth transition to the latest version of Marquez.\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"marquez-0300\"\n  }, \"Marquez 0.30.0\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/MarquezProject/marquez/releases/tag/0.30.0\"\n  }, \"Marquez 0.30.0\"), \",\\nwhich we released on 2023-01-31, contains some exciting new features, including\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/MarquezProject/marquez/pull/2293\"\n  }, \"column-level lineage\"), \" and\\na \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/MarquezProject/marquez/pull/2343\"\n  }, \"soft delete option\"), \" in\\nthe UI.\"), mdx(\"p\", null, \"Along with these long-awaited UI upgrades come some significant performance\\nimprovements to the API. In prior versions of Marquez, accessing OpenLineage\\nfacets required direct queries against the OpenLineage events table, which could\\nbe quite costly depending on the size of this table. Some users have events\\ntables with more than 100K rows -- millions of rows, in fact. To address this\\nperformance issue, Marquez 30.0 has new tables for dataset, job and run facets.\"), mdx(\"p\", null, \"So far, so simple, right? Protecting against data loss and ensuring a smooth\\nexperience for users was not so simple, in fact. We needed a way to migrate the\\ndata while not only avoiding loss but also keeping downtime to a minimum. The\\nsolution that \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/wslulciuc\"\n  }, \"Willy\"), \" and\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/pawel-big-lebowski\"\n  }, \"Pawel\"), \" found (with input from\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/collado-mike\"\n  }, \"Mike Collado\"), \") was to keep the data in the\\nevents table until the migration process is complete and to create views on top\\nof the table for accessing the facets. After migration is complete, the views\\nare replaced to point to the new tables. Using views provides safeguards and\\nminimizes downtime during the migration. \"), mdx(\"h2\", {\n    \"id\": \"migration-procedure\"\n  }, \"Migration Procedure\"), mdx(\"p\", null, \"As the\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/MarquezProject/marquez/blob/main/api/src/main/resources/marquez/db/migration/V57__readme.md\"\n  }, \"migration plan\"), \"\\nsays, users whose \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lineage_events\"), \" tables have up to 100K rows can set it and\\nforget it -- no extra work is required beyond upgrading and restarting\\nMarquez, but be prepared for a brief downtime while a standard Flyway migration\\nfills the newly created tables automatically.\"), mdx(\"p\", null, \"For heavy users whose \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lineage_events\"), \" tables have more than 100K rows, a\\ndifferent process will be used. Instead of a standard migration, the process will\\nhappen asynchronously so that the user can start the API and consume new\\nOpenLineage events as usual. Note that some API calls might return irrelevant\\nresults during the migration, especially if the output is based on facets.\"), mdx(\"p\", null, \"To perform a migration, these users must run the following command:\"), mdx(\"deckgo-highlight-code\", {\n    \"terminal\": \"carbon\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"java -jar api/build/libs/marquez-api-0.30.0.jar db-migrate --version v57 ./marquez.yml\"), \"\\n        \"), mdx(\"p\", null, \"Available command arguments, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"version\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"chunkSize\"), \", allow the user to specify\\nthe migration version to apply and the number of lineage events to process.\\nThe command will process the data not in its entirety but in chunks, storing a\\nstate with information about the chunks being processed. Consequently,\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"it can be stopped any time\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"it will continue automatically and process the remaining chunks. \")), mdx(\"p\", null, \"The default chunk size, 10,000, refers to the number of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lineage_events\"), \"\\nprocessed in a single query. The chunk size may be adjusted via command parameter:\"), mdx(\"deckgo-highlight-code\", {\n    \"terminal\": \"carbon\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"java -jar api/build/libs/marquez-api-0.30.0.jar db-migrate --version v57 --chunkSize 50000 ./marquez.yml\"), \"\\n        \"), mdx(\"h2\", {\n    \"id\": \"more-information\"\n  }, \"More Information\"), mdx(\"p\", null, \"For more details about what, if anything, you will need to do to ensure a smooth\\ntransition to Marquez 0.30.0, check out the helpful\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/MarquezProject/marquez/blob/main/api/src/main/resources/marquez/db/migration/V57__readme.md\"\n  }, \"migration plan\"), \"\\nput together by \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/wslulciuc\"\n  }, \"Willy\"), \" and\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/pawel-big-lebowski\"\n  }, \"Pawel\"), \". \"), mdx(\"p\", null, \"For more information about the improvements and additions in Marquez 0.30.0, check\\nout \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/MarquezProject/marquez/releases/tag/0.30.0\"\n  }, \"the release on GitHub\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Marquez 0.30.0 offers a big performance bump, with some assembly required","date":"03 February 2023","description":"How to ensure a smooth transition to the latest version of Marquez.","author":"Michael Robinson","banner":{"publicURL":"/static/ab471c310f1afc91147b39e98312007d/banner.svg","childImageSharp":null}}}},"pageContext":{"slug":"/blog/version-30-upgrades/"}},
    "staticQueryHashes": ["1139857438","1946588481","2083862410","2213455283","2418326273","3067102388"]}